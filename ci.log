1 file reformatted, 127 files left unchanged
Found 1 error (1 fixed, 0 remaining).
============================= test session starts ==============================
platform darwin -- Python 3.12.10, pytest-8.4.2, pluggy-1.6.0 -- /Users/teebz/space/space-os/.venv/bin/python
cachedir: .pytest_cache
rootdir: /Users/teebz/space/space-os
configfile: pyproject.toml
plugins: mock-3.15.1, cov-5.0.0, asyncio-1.2.0, timeout-2.4.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 316 items

tests/integration/test_agent_autonomy.py::test_agent_posts_mid_execution PASSED [  0%]
tests/integration/test_agent_autonomy.py::test_agent_loop_with_priority_blocking PASSED [  0%]
tests/integration/test_agent_autonomy.py::test_agent_coordination_multi_channel PASSED [  0%]
tests/integration/test_agent_autonomy.py::test_agent_loop_bookmark_isolation PASSED [  1%]
tests/integration/test_agent_command.py::test_agent_list PASSED          [  1%]
tests/integration/test_agent_command.py::test_agent_merge PASSED         [  1%]
tests/integration/test_agent_command.py::test_agent_merge_nonexistent_source PASSED [  2%]
tests/integration/test_agent_command.py::test_agent_merge_nonexistent_target PASSED [  2%]
tests/integration/test_agent_command.py::test_agent_rename PASSED        [  2%]
tests/integration/test_agent_id_data_flow.py::test_full_spawn_task_events_flow PASSED [  3%]
tests/integration/test_agent_id_data_flow.py::test_invalid_agent_id_rejected_in_emit PASSED [  3%]
tests/integration/test_agent_id_data_flow.py::test_emit_valid_agent_id PASSED [  3%]
tests/integration/test_agent_id_data_flow.py::test_agent_archival_preserves_invariant PASSED [  4%]
tests/integration/test_agent_id_data_flow.py::test_get_agent_name_none_handling PASSED [  4%]
tests/integration/test_agent_id_data_flow.py::test_task_preserve_agent_id PASSED [  4%]
tests/integration/test_agent_id_data_flow.py::test_multiple_agents_distinct_ids PASSED [  5%]
tests/integration/test_agent_id_data_flow.py::test_task_list_all_have_agent_id PASSED [  5%]
tests/integration/test_bridge.py::test_bridge_shows_readme PASSED        [  5%]
tests/integration/test_bridge.py::test_bridge_list_channels PASSED       [  6%]
tests/integration/test_bridge.py::test_bridge_channels_list PASSED       [  6%]
tests/integration/test_bridge.py::test_bridge_inbox_requires_identity PASSED [  6%]
tests/integration/test_bridge.py::test_bridge_inbox_with_identity PASSED [  6%]
tests/integration/test_bridge.py::test_send_creates_missing_channel PASSED [  7%]
tests/integration/test_bridge.py::test_bridge_recv_requires_identity PASSED [  7%]
tests/integration/test_bridge.py::test_bridge_export_channel PASSED      [  7%]
tests/integration/test_bridge_spawn_mention.py::test_spawn_from_mention_with_context PASSED [  8%]
tests/integration/test_bridge_spawn_mention.py::test_spawn_from_mention_export_fails PASSED [  8%]
tests/integration/test_bridge_spawn_mention.py::test_spawn_from_mention_returns_prompt PASSED [  8%]
tests/integration/test_bridge_spawn_mention.py::test_spawn_from_mention_invalid_identity PASSED [  9%]
tests/integration/test_council_command.py::test_council_command_creates_instance PASSED [  9%]
tests/integration/test_invocation_constitution.py::test_invocation_context_tracks_identity PASSED [  9%]
tests/integration/test_invocation_constitution.py::test_alias_normalize_wake PASSED [ 10%]
tests/integration/test_invocation_constitution.py::test_alias_preserve_flag PASSED [ 10%]
tests/integration/test_invocation_constitution.py::test_wake_explicit_flag_invocation PASSED [ 10%]
tests/integration/test_invocation_constitution.py::test_constitution_hash_addressable PASSED [ 11%]
tests/integration/test_invocation_constitution.py::test_invocation_agent_id PASSED [ 11%]
tests/integration/test_memory_integration.py::test_memory_shows_readme PASSED [ 11%]
tests/integration/test_memory_integration.py::test_add_requires_identity PASSED [ 12%]
tests/integration/test_memory_integration.py::test_add_with_identity PASSED [ 12%]
tests/integration/test_memory_integration.py::test_memory_replace_single PASSED [ 12%]
tests/integration/test_memory_integration.py::test_replace_merge PASSED  [ 12%]
tests/integration/test_memory_integration.py::test_memory_chain_query PASSED [ 13%]
tests/integration/test_memory_integration.py::test_memory_lineage_upward_traversal PASSED [ 13%]
tests/integration/test_memory_integration.py::test_lineage_downward PASSED [ 13%]
tests/integration/test_memory_integration.py::test_lineage_merge PASSED  [ 14%]
tests/integration/test_memory_integration.py::test_lineage_bidirectional PASSED [ 14%]
tests/integration/test_readme_protocols.py::test_space_no_args PASSED    [ 14%]
tests/integration/test_readme_protocols.py::test_space_help PASSED       [ 15%]
tests/integration/test_readme_protocols.py::test_bridge_no_args PASSED   [ 15%]
tests/integration/test_readme_protocols.py::test_bridge_help PASSED      [ 15%]
tests/integration/test_readme_protocols.py::test_memory_no_args PASSED   [ 16%]
tests/integration/test_readme_protocols.py::test_memory_help PASSED      [ 16%]
tests/integration/test_readme_protocols.py::test_knowledge_no_args PASSED [ 16%]
tests/integration/test_readme_protocols.py::test_knowledge_help PASSED   [ 17%]
tests/integration/test_readme_protocols.py::test_context_no_args PASSED  [ 17%]
tests/integration/test_readme_protocols.py::test_context_help PASSED     [ 17%]
tests/integration/test_spawn_bridge_integration.py::test_bridge_uses_spawn_tasks PASSED [ 18%]
tests/integration/test_spawn_bridge_integration.py::test_task_lifecycle_pending_to_completed PASSED [ 18%]
tests/integration/test_spawn_bridge_integration.py::test_multiple_agents_concurrent_tasks PASSED [ 18%]
tests/integration/test_spawn_command.py::test_constitution_injection PASSED [ 18%]
tests/integration/test_spawn_command.py::test_constitution_injection_with_model PASSED [ 19%]
tests/integration/test_spawn_command.py::test_constitution_hash PASSED   [ 19%]
tests/integration/test_spawn_command.py::test_save_and_load_constitution PASSED [ 19%]
tests/integration/test_spawn_command.py::test_constitution_idempotent_save PASSED [ 20%]
tests/integration/test_spawn_command.py::test_get_base_identity PASSED   [ 20%]
tests/integration/test_spawn_command.py::test_resolve_model_alias PASSED [ 20%]
tests/integration/test_spawn_command.py::test_get_constitution_path PASSED [ 21%]
tests/integration/test_spawn_task_tracking.py::test_channel_groups_tasks PASSED [ 21%]
tests/integration/test_spawn_task_tracking.py::test_channel_isolation PASSED [ 21%]
tests/integration/test_spawn_task_tracking.py::test_retrieve_channel_history PASSED [ 22%]
tests/integration/test_spawn_task_tracking.py::test_spawn_logs_metadata PASSED [ 22%]
tests/integration/test_spawn_task_tracking.py::test_mention_spawns_worker PASSED [ 22%]
tests/integration/test_spawn_task_tracking.py::test_task_provenance_chain PASSED [ 23%]
tests/integration/test_stats_cli.py::test_overview_command PASSED        [ 23%]
tests/integration/test_stats_cli.py::test_memory_command_not_initialized PASSED [ 23%]
tests/integration/test_stats_cli.py::test_knowledge_command_not_initialized PASSED [ 24%]
tests/integration/test_stats_cli.py::test_bridge_command_not_initialized PASSED [ 24%]
tests/integration/test_wake.py::test_wake_new_identity_spawn_count_zero PASSED [ 24%]
tests/integration/test_wake.py::test_wake_existing_identity_spawn_count PASSED [ 25%]
tests/integration/test_wake.py::test_command_unread_messages PASSED      [ 25%]
tests/integration/test_wake.py::test_wake_prioritizes_space_feedback PASSED [ 25%]
tests/integration/test_wake.py::test_show_wake_summary_uses_prompt_constants PASSED [ 25%]
tests/integration/test_wake_sleep.py::test_wake_requires_identity PASSED [ 26%]
tests/integration/test_wake_sleep.py::test_sleep_requires_identity PASSED [ 26%]
tests/unit/apps/context/test_context_filters.py::test_timeline_filter_by_uuid PASSED [ 26%]
tests/unit/apps/context/test_context_filters.py::test_current_state_filter_agent_id PASSED [ 27%]
tests/unit/apps/context/test_context_filters.py::test_timeline_invalid_identity_error PASSED [ 27%]
tests/unit/apps/context/test_search_input_validation.py::test_short_search_accepted PASSED [ 27%]
tests/unit/apps/context/test_search_input_validation.py::test_max_length_accepted PASSED [ 28%]
tests/unit/apps/context/test_search_input_validation.py::test_oversized_search_rejected PASSED [ 28%]
tests/unit/apps/context/test_search_input_validation.py::test_very_large_search_rejected PASSED [ 28%]
tests/unit/apps/context/test_search_input_validation.py::test_empty_search_accepted PASSED [ 29%]
tests/unit/apps/context/test_search_input_validation.py::test_error_message_informative PASSED [ 29%]
tests/unit/apps/context/test_search_input_validation.py::test_unicode_counts_toward_limit PASSED [ 29%]
tests/unit/apps/context/test_search_input_validation.py::test_regex_pattern_length_limited PASSED [ 30%]
tests/unit/apps/context/test_search_input_validation.py::test_boundary_max_plus_one_rejected PASSED [ 30%]
tests/unit/apps/context/test_search_input_validation.py::test_boundary_max_accepted PASSED [ 30%]
tests/unit/apps/context/test_search_input_validation.py::test_whitespace_counted_toward_limit PASSED [ 31%]
tests/unit/apps/context/test_search_input_validation.py::test_backtrack_limit PASSED [ 31%]
tests/unit/apps/context/test_search_input_validation.py::test_exponential_backtrack_limit PASSED [ 31%]
tests/unit/apps/context/test_search_input_validation.py::test_wildcard_within_limit PASSED [ 31%]
tests/unit/apps/context/test_search_input_validation.py::test_wildcard_oversized_rejected PASSED [ 32%]
tests/unit/apps/context/test_search_input_validation.py::test_max_length_is_defined PASSED [ 32%]
tests/unit/apps/context/test_search_input_validation.py::test_max_length_reasonable PASSED [ 32%]
tests/unit/apps/council/test_council_app.py::test_initialization PASSED  [ 33%]
tests/unit/apps/council/test_council_app.py::test_print_error_writes_stderr PASSED [ 33%]
tests/unit/apps/stats/test_sql_injection.py::test_valid_table_names PASSED [ 33%]
tests/unit/apps/stats/test_sql_injection.py::test_invalid_table_names PASSED [ 34%]
tests/unit/apps/stats/test_sql_injection.py::test_valid_column_names PASSED [ 34%]
tests/unit/apps/stats/test_sql_injection.py::test_invalid_column_names PASSED [ 34%]
tests/unit/apps/stats/test_sql_injection.py::test_table_not_in_whitelist PASSED [ 35%]
tests/unit/apps/stats/test_sql_injection.py::test_column_not_in_whitelist PASSED [ 35%]
tests/unit/apps/stats/test_sql_injection.py::test_get_columns_valid_table PASSED [ 35%]
tests/unit/apps/stats/test_sql_injection.py::test_get_columns_invalid_table PASSED [ 36%]
tests/unit/apps/stats/test_sql_injection.py::test_get_columns_injection_attempt PASSED [ 36%]
tests/unit/apps/stats/test_sql_injection.py::test_get_common_db_stats_invalid_table PASSED [ 36%]
tests/unit/apps/stats/test_sql_injection.py::test_get_common_db_stats_invalid_column PASSED [ 37%]
tests/unit/apps/stats/test_sql_injection.py::test_invalid_leaderboard_column PASSED [ 37%]
tests/unit/apps/stats/test_sql_injection.py::test_discover_invalid_table PASSED [ 37%]
tests/unit/apps/stats/test_sql_injection.py::test_discover_injection_table PASSED [ 37%]
tests/unit/apps/stats/test_sql_injection.py::test_validate_table_valid PASSED [ 38%]
tests/unit/apps/stats/test_sql_injection.py::test_validate_table_invalid PASSED [ 38%]
tests/unit/apps/stats/test_sql_injection.py::test_validate_table_not_whitelisted PASSED [ 38%]
tests/unit/apps/stats/test_sql_injection.py::test_add_column_invalid_table PASSED [ 39%]
tests/unit/apps/stats/test_sql_injection.py::test_add_column_invalid_column_name PASSED [ 39%]
tests/unit/apps/stats/test_sql_injection.py::test_add_column_invalid_type PASSED [ 39%]
tests/unit/apps/stats/test_sql_injection.py::test_add_column_valid PASSED [ 40%]
tests/unit/apps/stats/test_sql_injection.py::test_events_query_parameterized PASSED [ 40%]
tests/unit/apps/stats/test_sql_injection.py::test_stats_leaderboard_parameterized PASSED [ 40%]
tests/unit/apps/stats/test_sql_injection.py::test_valid_tables_not_empty PASSED [ 41%]
tests/unit/apps/stats/test_sql_injection.py::test_valid_columns_not_empty PASSED [ 41%]
tests/unit/apps/stats/test_sql_injection.py::test_core_tables_included PASSED [ 41%]
tests/unit/apps/stats/test_sql_injection.py::test_core_columns_included PASSED [ 42%]
tests/unit/apps/stats/test_sql_injection.py::test_no_sql_syntax_in_identifiers PASSED [ 42%]
tests/unit/apps/stats/test_stats_app.py::test_discovers_registered_agents PASSED [ 42%]
tests/unit/apps/stats/test_stats_app.py::test_discovers_orphaned_agents_in_events PASSED [ 43%]
tests/unit/apps/stats/test_stats_app.py::test_discovers_orphaned_agents_in_messages PASSED [ 43%]
tests/unit/apps/stats/test_stats_app.py::test_discovers_orphaned_agents_in_memory PASSED [ 43%]
tests/unit/apps/stats/test_stats_app.py::test_discovers_orphaned_agents_in_knowledge PASSED [ 43%]
tests/unit/apps/stats/test_stats_app.py::test_maps_registered_name_to_orphaned_agent PASSED [ 44%]
tests/unit/apps/stats/test_stats_app.py::test_aggregates_stats_from_all_tables PASSED [ 44%]
tests/unit/apps/stats/test_stats_app.py::test_respects_archived_filter PASSED [ 44%]
tests/unit/apps/stats/test_stats_app.py::test_orphaned_agents_always_included PASSED [ 45%]
tests/unit/apps/stats/test_stats_app.py::test_discovery_counts_match_universe PASSED [ 45%]
tests/unit/commands/test_backup.py::test_backup_creates_timestamped_dir PASSED [ 45%]
tests/unit/commands/test_backup.py::test_backup_copies_db_files PASSED   [ 46%]
tests/unit/commands/test_backup.py::test_backup_stats_counts_rows PASSED [ 46%]
tests/unit/os/bridge/test_bridge_db.py::test_bookmark_respects_bookmarks PASSED [ 46%]
tests/unit/os/bridge/test_bridge_db.py::test_get_new_messages_summary_channel_no_special_handling PASSED [ 47%]
tests/unit/os/bridge/test_bridge_db.py::test_get_new_messages_mixed_id_types PASSED [ 47%]
tests/unit/os/bridge/test_bridge_db.py::test_alerts_set_bookmarks PASSED [ 47%]
tests/unit/os/bridge/test_bridge_db.py::test_note_convert_identity PASSED [ 48%]
tests/unit/os/bridge/test_bridge_db.py::test_notes_return_agent_id PASSED [ 48%]
tests/unit/os/bridge/test_messages.py::test_send_message PASSED          [ 48%]
tests/unit/os/bridge/test_messages.py::test_recv_updates PASSED          [ 49%]
tests/unit/os/bridge/test_messages.py::test_fetch_messages PASSED        [ 49%]
tests/unit/os/bridge/test_messages.py::test_fetch_sender_history PASSED  [ 49%]
tests/unit/os/bridge/test_messages.py::test_create_channel_with_topic PASSED [ 50%]
tests/unit/os/bridge/test_messages.py::test_create_channel_without_topic PASSED [ 50%]
tests/unit/os/bridge/test_messages.py::test_active_channels_filter_unreads FAILED [ 50%]
tests/unit/os/bridge/test_messages.py::test_active_channels_limit_five PASSED [ 50%]
tests/unit/os/bridge/test_messages.py::test_inbox_channels_all_unreads FAILED [ 51%]
tests/unit/os/bridge/test_messages.py::test_recv_summary_latest PASSED   [ 51%]
tests/unit/os/bridge/test_parser.py::test_parse_mentions_single PASSED   [ 51%]
tests/unit/os/bridge/test_parser.py::test_parse_mentions_multiple PASSED [ 52%]
tests/unit/os/bridge/test_parser.py::test_parse_mentions_no_duplicates PASSED [ 52%]
tests/unit/os/bridge/test_parser.py::test_parse_mentions_none PASSED     [ 52%]
tests/unit/os/bridge/test_parser.py::test_extract_mention_task_simple PASSED [ 53%]
tests/unit/os/bridge/test_parser.py::test_extract_mention_task_with_newlines PASSED [ 53%]
tests/unit/os/bridge/test_parser.py::test_extract_mention_multiple PASSED [ 53%]
tests/unit/os/bridge/test_parser.py::test_extract_mention_task_empty PASSED [ 54%]
tests/unit/os/bridge/test_parser.py::test_extract_mention_task_not_found PASSED [ 54%]
tests/unit/os/bridge/test_parser.py::test_build_prompt_success PASSED    [ 54%]
tests/unit/os/bridge/test_parser.py::test_build_prompt_failure PASSED    [ 55%]
tests/unit/os/bridge/test_parser.py::test_build_prompt_timeout PASSED    [ 55%]
tests/unit/os/db/test_migrations.py::test_bridge_db_migration_converts_messages_id_to_text PASSED [ 55%]
tests/unit/os/db/test_sqlite.py::test_connect_basic PASSED               [ 56%]
tests/unit/os/db/test_sqlite.py::test_register_database PASSED           [ 56%]
tests/unit/os/db/test_sqlite.py::test_register_migrations PASSED         [ 56%]
tests/unit/os/db/test_sqlite.py::test_ensure_unregistered_raises PASSED  [ 56%]
tests/unit/os/db/test_sqlite.py::test_ensure_creates_schema PASSED       [ 57%]
tests/unit/os/db/test_sqlite.py::test_migrate_basic PASSED               [ 57%]
tests/unit/os/db/test_sqlite.py::test_migrate_callable PASSED            [ 57%]
tests/unit/os/db/test_sqlite.py::test_migrate_skips_applied PASSED       [ 58%]
tests/unit/os/db/test_sqlite.py::test_ensure_schema_with_migrations PASSED [ 58%]
tests/unit/os/db/test_utils.py::test_from_row_basic PASSED               [ 58%]
tests/unit/os/db/test_utils.py::test_from_row_partial_fields PASSED      [ 59%]
tests/unit/os/db/test_utils.py::test_from_row_missing_optional_fields PASSED [ 59%]
tests/unit/os/events/test_events.py::test_emit_event PASSED              [ 59%]
tests/unit/os/events/test_events.py::test_query_events PASSED            [ 60%]
tests/unit/os/lib/test_aliasing.py::test_bridge_list_alias PASSED        [ 60%]
tests/unit/os/lib/test_aliasing.py::test_bridge_list_with_options PASSED [ 60%]
tests/unit/os/lib/test_aliasing.py::test_bridge_positional_identity PASSED [ 61%]
tests/unit/os/lib/test_aliasing.py::test_bridge_identity_then_subcommand PASSED [ 61%]
tests/unit/os/lib/test_aliasing.py::test_wake_positional_identity PASSED [ 61%]
tests/unit/os/lib/test_aliasing.py::test_sleep_positional_identity PASSED [ 62%]
tests/unit/os/lib/test_aliasing.py::test_flag_args_not_treated_as_identity PASSED [ 62%]
tests/unit/os/lib/test_aliasing.py::test_empty_argv PASSED               [ 62%]
tests/unit/os/lib/test_aliasing.py::test_no_match PASSED                 [ 62%]
tests/unit/os/lib/test_config.py::test_config_loads_default_values PASSED [ 63%]
tests/unit/os/lib/test_identity.py::test_inject_includes_constitution PASSED [ 63%]
tests/unit/os/lib/test_identity.py::test_inject_with_model PASSED        [ 63%]
tests/unit/os/lib/test_identity.py::test_description_persist PASSED      [ 64%]
tests/unit/os/lib/test_identity.py::test_description_update PASSED       [ 64%]
tests/unit/os/lib/test_ids_input_validation.py::test_invalid_table_rejected PASSED [ 64%]
tests/unit/os/lib/test_ids_input_validation.py::test_invalid_column_rejected PASSED [ 65%]
tests/unit/os/lib/test_ids_input_validation.py::test_union_select_injection_rejected PASSED [ 65%]
tests/unit/os/lib/test_ids_input_validation.py::test_comment_escape_injection_rejected PASSED [ 65%]
tests/unit/os/lib/test_ids_input_validation.py::test_stacked_query_injection_rejected PASSED [ 66%]
tests/unit/os/lib/test_ids_input_validation.py::test_case_sensitive_table_validation PASSED [ 66%]
tests/unit/os/lib/test_ids_input_validation.py::test_case_sensitive_column_validation PASSED [ 66%]
tests/unit/os/lib/test_ids_input_validation.py::test_empty_table_name_rejected PASSED [ 67%]
tests/unit/os/lib/test_ids_input_validation.py::test_empty_column_name_rejected PASSED [ 67%]
tests/unit/os/lib/test_ids_input_validation.py::test_whitespace_only_table_rejected PASSED [ 67%]
tests/unit/os/lib/test_ids_input_validation.py::test_whitespace_only_column_rejected PASSED [ 68%]
tests/unit/os/lib/test_ids_input_validation.py::test_sql_chars_table_rejected PASSED [ 68%]
tests/unit/os/lib/test_ids_input_validation.py::test_sql_chars_column_rejected PASSED [ 68%]
tests/unit/os/lib/test_ids_input_validation.py::test_partial_id_is_safe_parameterized PASSED [ 68%]
tests/unit/os/lib/test_ids_input_validation.py::test_valid_tables_not_empty PASSED [ 69%]
tests/unit/os/lib/test_ids_input_validation.py::test_valid_columns_not_empty PASSED [ 69%]
tests/unit/os/lib/test_ids_input_validation.py::test_core_tables_included PASSED [ 69%]
tests/unit/os/lib/test_ids_input_validation.py::test_core_id_columns_included PASSED [ 70%]
tests/unit/os/lib/test_ids_input_validation.py::test_no_sql_syntax_in_whitelist PASSED [ 70%]
tests/unit/os/lib/test_paths.py::test_space_root PASSED                  [ 70%]
tests/unit/os/lib/test_paths.py::test_space_data PASSED                  [ 71%]
tests/unit/os/lib/test_paths.py::test_canon_path_from_config PASSED      [ 71%]
tests/unit/os/lib/test_paths.py::test_canon_path_default PASSED          [ 71%]
tests/unit/os/memory/test_memory_migration.py::test_memory_migration_preserves_data PASSED [ 72%]
tests/unit/os/memory/test_memory_migration.py::test_memory_migration_idempotent PASSED [ 72%]
tests/unit/os/spawn/test_alias_resolution.py::test_alias_normalize_positional_identity PASSED [ 72%]
tests/unit/os/spawn/test_alias_resolution.py::test_alias_preserve_existing_flags PASSED [ 73%]
tests/unit/os/spawn/test_alias_resolution.py::test_alias_preserve_non_identity_args PASSED [ 73%]
tests/unit/os/spawn/test_alias_resolution.py::test_alias_resolve_command_path PASSED [ 73%]
tests/unit/os/spawn/test_alias_resolution.py::test_alias_supports_direct_shortcuts PASSED [ 74%]
tests/unit/os/spawn/test_constitution_injection.py::test_header_injection PASSED [ 74%]
tests/unit/os/spawn/test_constitution_injection.py::test_footer_injection PASSED [ 74%]
tests/unit/os/spawn/test_constitution_injection.py::test_canon_injection_order PASSED [ 75%]
tests/unit/os/spawn/test_db.py::test_save_get_agent_identity PASSED      [ 75%]
tests/unit/os/spawn/test_db.py::test_save_long_id PASSED                 [ 75%]
tests/unit/os/spawn/test_db.py::test_save_special_chars_id PASSED        [ 75%]
tests/unit/os/spawn/test_db.py::test_create_task PASSED                  [ 76%]
tests/unit/os/spawn/test_db.py::test_update_task_status PASSED           [ 76%]
tests/unit/os/spawn/test_db.py::test_complete_task PASSED                [ 76%]
tests/unit/os/spawn/test_db.py::test_fail_task PASSED                    [ 77%]
tests/unit/os/spawn/test_db.py::test_list_tasks PASSED                   [ 77%]
tests/unit/os/spawn/test_identity_spawn.py::test_hailot_zealot_prompt_lookup PASSED [ 77%]
tests/unit/os/spawn/test_identity_spawn.py::test_inject_self_description PASSED [ 78%]
tests/unit/os/spawn/test_identity_spawn.py::test_inject_with_model PASSED [ 78%]
tests/unit/os/spawn/test_identity_spawn.py::test_inject_canon PASSED     [ 78%]
tests/unit/os/spawn/test_identity_spawn.py::test_inject_assembly_order PASSED [ 79%]
tests/unit/os/spawn/test_invocation.py::test_tracks_identity PASSED      [ 79%]
tests/unit/os/spawn/test_invocation.py::test_parses_command PASSED       [ 79%]
tests/unit/os/spawn/test_invocation.py::test_no_identity PASSED          [ 80%]
tests/unit/os/spawn/test_invocation.py::test_emits_to_events PASSED      [ 80%]
tests/unit/os/spawn/test_invocation.py::test_preserves_original_args PASSED [ 80%]
tests/unit/os/spawn/test_providers.py::test_gemini PASSED                [ 81%]
tests/unit/os/spawn/test_providers.py::test_claude PASSED                [ 81%]
tests/unit/os/spawn/test_providers.py::test_codex PASSED                 [ 81%]
tests/unit/os/spawn/test_providers.py::test_run_launch_process_error PASSED [ 81%]
tests/unit/os/spawn/test_providers.py::test_run_launch_file_not_found PASSED [ 82%]
tests/unit/os/spawn/test_task_commands.py::test_tasks_list_empty PASSED  [ 82%]
tests/unit/os/spawn/test_task_commands.py::test_tasks_list_shows_running PASSED [ 82%]
tests/unit/os/spawn/test_task_commands.py::test_tasks_list_filter_by_status PASSED [ 83%]
tests/unit/os/spawn/test_task_commands.py::test_tasks_list_filter_by_identity PASSED [ 83%]
tests/unit/os/spawn/test_task_commands.py::test_logs_shows_full_task_detail PASSED [ 83%]
tests/unit/os/spawn/test_task_commands.py::test_logs_shows_failed_task_stderr PASSED [ 84%]
tests/unit/os/spawn/test_task_commands.py::test_logs_task_not_found PASSED [ 84%]
tests/unit/os/spawn/test_task_lifecycle.py::test_task_pending_to_running PASSED [ 84%]
tests/unit/os/spawn/test_task_lifecycle.py::test_task_running_to_completed PASSED [ 85%]
tests/unit/os/spawn/test_task_lifecycle.py::test_task_running_to_failed PASSED [ 85%]
tests/unit/os/spawn/test_task_lifecycle.py::test_task_pending_to_timeout PASSED [ 85%]
tests/unit/os/spawn/test_task_lifecycle.py::test_task_lifecycle_with_channel PASSED [ 86%]
tests/unit/os/spawn/test_task_lifecycle.py::test_multiple_tasks_per_identity PASSED [ 86%]
tests/unit/os/spawn/test_task_lifecycle.py::test_task_output_capture PASSED [ 86%]
tests/unit/os/spawn/test_task_wait_kill.py::test_wait_blocks_until_completion PASSED [ 87%]
tests/unit/os/spawn/test_task_wait_kill.py::test_wait_exit_code PASSED   [ 87%]
tests/unit/os/spawn/test_task_wait_kill.py::test_wait_timeout PASSED     [ 87%]
tests/unit/os/spawn/test_task_wait_kill.py::test_wait_pending PASSED     [ 87%]
tests/unit/os/spawn/test_task_wait_kill.py::test_kill_running_task PASSED [ 88%]
tests/unit/os/spawn/test_task_wait_kill.py::test_kill_nonexistent_task PASSED [ 88%]
tests/unit/os/spawn/test_task_wait_kill.py::test_kill_completed_task_no_op PASSED [ 88%]
tests/unit/os/spawn/test_task_wait_kill.py::test_task_pid_tracking PASSED [ 89%]
tests/unit/os/test_agent_id_validation.py::test_emit_valid_agent_id PASSED [ 89%]
tests/unit/os/test_agent_id_validation.py::test_emit_none_agent_id PASSED [ 89%]
tests/unit/os/test_agent_id_validation.py::test_emit_no_agent_id PASSED  [ 90%]
tests/unit/os/test_agent_id_validation.py::test_emit_rejects_empty_agent_id PASSED [ 90%]
tests/unit/os/test_agent_id_validation.py::test_emit_rejects_whitespace_agent_id PASSED [ 90%]
tests/unit/os/test_agent_id_validation.py::test_emit_rejects_non_string_agent_id PASSED [ 91%]
tests/unit/os/test_agent_id_validation.py::test_emit_rejects_list_agent_id PASSED [ 91%]
tests/unit/os/test_agent_id_validation.py::test_logs_rejects_null_agent_id PASSED [ 91%]
tests/unit/os/test_agent_id_validation.py::test_ensure_agent_creates PASSED [ 92%]
tests/unit/os/test_agent_id_validation.py::test_ensure_agent_returns_existing PASSED [ 92%]
tests/unit/os/test_agent_id_validation.py::test_ensure_agent_restores_archived PASSED [ 92%]
tests/unit/os/test_agent_id_validation.py::test_create_task_valid_agent PASSED [ 93%]
tests/unit/os/test_agent_id_validation.py::test_create_task_rejects_nonexistent_agent PASSED [ 93%]
tests/unit/os/test_agent_id_validation.py::test_get_agent_name_valid PASSED [ 93%]
tests/unit/os/test_agent_id_validation.py::test_get_agent_name_none_invalid PASSED [ 93%]
tests/unit/os/test_agent_id_validation.py::test_get_agent_name_fallback PASSED [ 94%]
tests/unit/os/test_events_security.py::test_validate_table_valid PASSED  [ 94%]
tests/unit/os/test_events_security.py::test_validate_table_rejects_semicolon PASSED [ 94%]
tests/unit/os/test_events_security.py::test_validate_table_rejects_quotes PASSED [ 95%]
tests/unit/os/test_events_security.py::test_validate_table_rejects_unlisted PASSED [ 95%]
tests/unit/os/test_events_security.py::test_validate_table_rejects_empty PASSED [ 95%]
tests/unit/os/test_events_security.py::test_add_column_valid PASSED      [ 96%]
tests/unit/os/test_events_security.py::test_add_column_rejects_invalid_table PASSED [ 96%]
tests/unit/os/test_events_security.py::test_add_column_rejects_invalid_name PASSED [ 96%]
tests/unit/os/test_events_security.py::test_add_column_rejects_invalid_type PASSED [ 97%]
tests/unit/os/test_events_security.py::test_add_column_skip_existing PASSED [ 97%]
tests/unit/os/test_events_security.py::test_identifier_valid PASSED      [ 97%]
tests/unit/os/test_events_security.py::test_identifier_rejects_space PASSED [ 98%]
tests/unit/os/test_events_security.py::test_identifier_rejects_sql PASSED [ 98%]
tests/unit/os/test_events_security.py::test_identifier_type_spaces PASSED [ 98%]
tests/unit/os/test_events_security.py::test_identifier_type_rejects_injection PASSED [ 99%]
tests/unit/os/test_events_security.py::test_query_injection_safe PASSED  [ 99%]
tests/unit/os/test_events_security.py::test_migrate_add_agent_id PASSED  [ 99%]
tests/unit/os/test_events_security.py::test_migrate_add_chat_id PASSED   [100%]

=================================== FAILURES ===================================
_____________________ test_active_channels_filter_unreads ______________________

test_space = PosixPath('/private/var/folders/m8/2snr4d0x6gd7y0bvycft2cnr0000gn/T/pytest-of-teebz/pytest-2654/test_active_channels_filter_un0/workspace')

    def test_active_channels_filter_unreads(test_space):
        channel1 = db.create_channel("active-1")
        channel2 = db.create_channel("active-2")
        channel3 = db.create_channel("active-3")
        agent_id = "test-agent"
    
        db.send_message(channel1, "sender", "msg1")
        db.send_message(channel2, "sender", "msg2")
        db.send_message(channel3, "sender", "msg3")
    
        active = db.active_channels(agent_id=agent_id)
        assert len(active) == 3
    
        db.recv_updates(channel1, agent_id)
    
        active = db.active_channels(agent_id=agent_id)
>       assert len(active) == 2
E       AssertionError: assert 3 == 2
E        +  where 3 = len([Channel(channel_id='47b63ce8-3406-44c6-8dc5-c553bce83cfb', name='active-3', topic=None, created_at='2025-10-24 17:52:56', archived_at=None, participants=['cd5a0d80-3d48-4ff4-9cca-4fb28e9431d8'], message_count=1, last_activity='2025-10-24 17:52:56', unread_count=1, notes_count=0), Channel(channel_id='9fcc69bb-b998-4398-bf44-3675da895988', name='active-1', topic=None, created_at='2025-10-24 17:52:56', archived_at=None, participants=['cd5a0d80-3d48-4ff4-9cca-4fb28e9431d8'], message_count=1, last_activity='2025-10-24 17:52:56', unread_count=1, notes_count=0), Channel(channel_id='e4d582f8-74b7-4f6f-b86a-434df156fafb', name='active-2', topic=None, created_at='2025-10-24 17:52:56', archived_at=None, participants=['cd5a0d80-3d48-4ff4-9cca-4fb28e9431d8'], message_count=1, last_activity='2025-10-24 17:52:56', unread_count=1, notes_count=0)])

tests/unit/os/bridge/test_messages.py:92: AssertionError
_______________________ test_inbox_channels_all_unreads ________________________

test_space = PosixPath('/private/var/folders/m8/2snr4d0x6gd7y0bvycft2cnr0000gn/T/pytest-of-teebz/pytest-2654/test_inbox_channels_all_unread0/workspace')

    def test_inbox_channels_all_unreads(test_space):
        agent_id = "test-agent"
        for i in range(7):
            channel_id = db.create_channel(f"inbox-{i}")
            db.send_message(channel_id, "sender", f"msg-{i}")
    
        inbox = db.inbox_channels(agent_id=agent_id)
        assert len(inbox) == 7
    
        first_channel = db.resolve_channel_id("inbox-0")
        db.recv_updates(first_channel, agent_id)
    
        inbox = db.inbox_channels(agent_id=agent_id)
>       assert len(inbox) == 6
E       AssertionError: assert 7 == 6
E        +  where 7 = len([Channel(channel_id='0a590472-c8fc-478a-8f5e-e07a3caacd3d', name='inbox-2', topic=None, created_at='2025-10-24 17:52:56', archived_at=None, participants=['cb52da74-232b-42ba-8317-5816db25cb53'], message_count=1, last_activity='2025-10-24 17:52:56', unread_count=1, notes_count=0), Channel(channel_id='110ee72f-467a-4bce-a313-bb02fd6f5f68', name='inbox-6', topic=None, created_at='2025-10-24 17:52:56', archived_at=None, participants=['cb52da74-232b-42ba-8317-5816db25cb53'], message_count=1, last_activity='2025-10-24 17:52:56', unread_count=1, notes_count=0), Channel(channel_id='5a5aa62c-829c-4653-817f-7c5cba206d0e', name='inbox-0', topic=None, created_at='2025-10-24 17:52:56', archived_at=None, participants=['cb52da74-232b-42ba-8317-5816db25cb53'], message_count=1, last_activity='2025-10-24 17:52:56', unread_count=1, notes_count=0), Channel(channel_id='6e057b30-a974-46a7-87db-4dfe74455fd7', name='inbox-4', topic=None, created_at='2025-10-24 17:52:56', archived_at=None, participants=['cb52da74-232b-42ba-8317-5816db25cb53'], message_count=1, last_activity='2025-10-24 17:52:56', unread_count=1, notes_count=0), Channel(channel_id='b6566c33-e3ff-4701-b941-f734346fe38a', name='inbox-3', topic=None, created_at='2025-10-24 17:52:56', archived_at=None, participants=['cb52da74-232b-42ba-8317-5816db25cb53'], message_count=1, last_activity='2025-10-24 17:52:56', unread_count=1, notes_count=0), Channel(channel_id='da0d2d26-602a-45ee-9177-fcc037fcf1e2', name='inbox-5', topic=None, created_at='2025-10-24 17:52:56', archived_at=None, participants=['cb52da74-232b-42ba-8317-5816db25cb53'], message_count=1, last_activity='2025-10-24 17:52:56', unread_count=1, notes_count=0), ...])

tests/unit/os/bridge/test_messages.py:119: AssertionError
=========================== short test summary info ============================
FAILED tests/unit/os/bridge/test_messages.py::test_active_channels_filter_unreads
FAILED tests/unit/os/bridge/test_messages.py::test_inbox_channels_all_unreads
======================== 2 failed, 314 passed in 4.33s =========================
error: Recipe `test` failed on line 16 with exit code 1
